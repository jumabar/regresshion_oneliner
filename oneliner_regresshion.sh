# hosts_file : archivo con ips, dominios.
# timeout :  el tiempo de conexion maximo.
timeout=10; hosts_file="hosts.txt"; check_vulnerability() { local line="$1"; local version=$(echo "$line" | grep -oP 'OpenSSH_\K[\d\.]+'); if [[ -z "$version" ]]; then echo "No se pudo determinar la versión de OpenSSH en la línea proporcionada: $line"; return; fi; echo "Versión: $version"; echo "Banner: $line"; if [[ "$(printf '%s\n' "$version" "4.4" | sort -V | head -n1)" == "$version" ]]; then echo "Posible vulnerable <4.4p1"; elif [[ "$(printf '%s\n' "$version" "8.5" | sort -V | head -n1)" == "4.4" ]]; then echo "No seria vulnerable 4.4p1 y 8.4"; else echo "Vulnerable >8.5p1"; fi; }; [ ! -f "$hosts_file" ] && echo "El archivo $hosts_file no existe o no es accesible." && exit 1; while IFS= read -r host || [[ -n "$host" ]]; do echo "Host: $host"; ssh_version=$(echo "SSH-2.0-" | nc -w "$timeout" "$host" 22 | grep "SSH-" | head -n 1 | cut -d' ' -f2-); if [[ -n "$ssh_version" ]]; then check_vulnerability "$ssh_version"; else echo "No se pudo obtener la versión de SSH en $host dentro del tiempo especificado ($timeout segundos)"; fi; echo ""; done < "$hosts_file"
